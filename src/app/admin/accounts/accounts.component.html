<div>
  <div class="p-1 m-2 fixed-card">
    <div class="d-flex justify-content-between">
      <div
        class="d-flex align-items-center justify-content-center pointer-cursor"
        (click)="goBack()"
      >
        <span class="me-2 d-flex align-items-center">
          <img src="../../../assets/images/icons/left-arrow.svg" alt="Back" />
        </span>
        <b>
          <span class="back-btn-text">Accounts </span>
        </b>
      </div>
      <button
        pButton
        label="Export"
        icon="pi pi-file"
        class="p-button-info mb-2"
        (click)="exportAccountsToCSV()"
      ></button>
    </div>
  </div>
  <div class="m-2">
    <p-table
      #accountTable
      [value]="accounts"
      [lazy]="true"
      (onLazyLoad)="loadAccounts($event)"
      selectionMode="single"
      (onRowSelect)="viewAccount($event)"
      dataKey="id"
      [showCurrentPageReport]="true"
      [rowsPerPageOptions]="[10, 25, 50, 100]"
      [paginator]="true"
      [rows]="initialRows"
      [first]="initialFirst"
      [totalRecords]="accountsCount"
      [loading]="apiLoading"
      class="p-datatable-striped"
      responsiveLayout="scroll"
      scrollHeight="flex"
      [globalFilterFields]="[
        'accountId',
        'businessName',
        'name',
        'mobile',
        'emailId',
        'city',
        'walletBalance',
        'latest_plan_name',
        'latest_status',
        'latest_remark'
      ]"
      styleClass="p-datatable-customers "
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} Accounts"
    >
      <ng-template pTemplate="caption">
        <div class="row">
          <div class="col-md-3 mt-2 no-padding-small">
            <div class="p-inputgroup">
              <input
                type="text"
                pInputText
                placeholder="Search Business Name"
                [(ngModel)]="userNameToSearch"
                (ngModelChange)="
                  inputValueChangeEvent('loanId', userNameToSearch)
                "
                (keyup.enter)="filterWithName()"
              />
              <button
                type="button"
                pButton
                class="p-button-primary search-btn"
                [disabled]="!userNameToSearch"
                (click)="filterWithName()"
              >
                <img
                  src="assets/images/icons/search.svg"
                  alt="Search"
                  width="16"
                  height="16"
                  style="vertical-align: middle"
                />
              </button>
            </div>
            <!-- <input
              pInputText
              type="text"
              (input)="onSearchInput($event)"
              placeholder="Search reports..."
              class="form-control"
            /> -->
          </div>
          <div class="col-md-3 mt-2 no-padding-small text-right">
            <p-dropdown
              styleClass="text-left"
              [style]="{ width: '100%' }"
              [options]="accountInternalStatusList"
              (onChange)="statusChange($event)"
              [dropdownIcon]="'pi pi-chevron-down'"
              [(ngModel)]="selectedAccountStatus"
              optionLabel="displayName"
              appendTo="body"
              dataKey="name"
            >
            </p-dropdown>
          </div>
          <div class="col-md-3 no-padding-small"></div>
          <div class="col-md-3 mt-2 no-padding-small text-right">
            <div class="d-flex">
              <div class="flex-grow-1 me-2"></div>
              <div class="d-flex align-items-center pointer-cursor">
                <app-filter
                  [position]="'right'"
                  [iconColor]="'#33009C'"
                  [iconSize]="'28px!important'"
                  (filterEvent)="applyConfigFilters($event)"
                  [filterConfig]="filterConfig"
                  [showFilterIndication]="appliedFilter"
                  pTooltip="Filter"
                  tooltipPosition="top"
                >
                </app-filter>
              </div>
            </div>
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th class="text-nowrap">Account Id</th>
          <th>Business Name</th>
          <th>Person Name</th>
          <th class="text-nowrap">Mobile</th>
          <!-- <th class="text-nowrap">Email</th>
          <th class="text-nowrap">City</th> -->
          <th class="text-nowrap">Wallet Balance</th>
          <th class="text-nowrap">Plan</th>
          <th class="text-nowrap">Plan Status</th>
          <th class="text-nowrap">Remarks</th>
          <th class="text-nowrap">Status</th>

          <th>Created Date</th>
          <!-- <th>Status</th> -->
          <th>Last Updated</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-team>
        <tr
          [pSelectableRow]="team"
          class="text-capitalize"
          [ngClass]="{ 'disabled-row': team.disabled }"
        >
          <td>
            <span class="table-column-data" *ngIf="team.accountId">{{
              team.accountId
            }}</span>
          </td>

          <td>
            <span *ngIf="team.businessName" class="table-column-data">
              {{ team.businessName | capitalizeFirst }}
            </span>
          </td>

          <td>
            <span *ngIf="team.name" class="table-column-data">
              {{ team.name | capitalizeFirst }}
            </span>
          </td>

          <td>
            <span class="table-column-data" *ngIf="team.mobile">{{
              team.mobile
            }}</span>
          </td>

          <!-- <td>
            <span
              class="table-column-data text-lowercase"
              *ngIf="team.emailId"
              >{{ team.emailId }}</span
            >
          </td>

          <td>
            <span class="table-column-data" *ngIf="team.city">{{
              team.city
            }}</span>
          </td> -->

          <td>
            <span class="table-column-data" *ngIf="team.walletBalance">{{
              team.walletBalance
            }}</span>
          </td>

          <td>
            <span class="table-column-data" *ngIf="team.latest_plan_name">{{
              team.latest_plan_name
            }}</span>
          </td>

          <td>
            <span class="table-column-data" *ngIf="team.latest_status">{{
              team.latest_status
            }}</span>
          </td>

          <td>
            <span class="table-column-data" *ngIf="team.latest_remark">{{
              team.latest_remark
            }}</span>
          </td>

          <!-- <td>
            <span
              class="table-column-data fw-bold"
              *ngIf="team.status"
              [ngStyle]="{
                color: team.status === '1' ? 'green' : team.status === '2' ? 'red' : ''
              }"
            >
              {{ team.status === '1' ? 'Active' : team.status === '2' ? 'Inactive' : '' }}
            </span>
          </td> -->
          <td>
            <span
              class="table-column-data fw-bold d-inline-flex align-items-center gap-2"
              *ngIf="team.status"
              [ngStyle]="{
                backgroundColor: team.status === '1' ? '#E6F4EA' : '#FDECEA',
                color: team.status === '1' ? '#1E7E34' : '#C82333',
                height: '22px',
                borderRadius: '16px',
                fontSize: '12px',
                fontWeight: 500,
                padding: '0 10px'
              }"
            >
              <!-- Dot -->
              <span
                class="rounded-circle"
                [ngStyle]="{
                  backgroundColor: team.status === '1' ? '#28A745' : '#DC3545',
                  width: '8px',
                  height: '8px',
                  display: 'inline-block'
                }"
              ></span>

              <!-- Status Text -->
              {{ team.status === '1' ? 'Active' : 'Inactive' }}
            </span>
          </td>

          <td>
            <span class="table-column-data" *ngIf="team.createdOn">{{
              team.createdOn | date
            }}</span>
          </td>

          <td>
            <span class="table-column-data" *ngIf="team.lastUpdatedOn">{{
              team.lastUpdatedOn | date
            }}</span>
          </td>

          <td>
            <div class="d-flex">
              <div >
                <button
                  *ngIf="loggedInUserRole == 1"
                  pButton
                  type="button"
                  label="Login"
                  icon="pi pi-sign-in"
                  class="p-button-sm p-button-primary"
                  [loading]="loadingProviderLogin[team.accountId]"
                  [disabled]="loadingProviderLogin[team.accountId]"
                  (click)="onLoginAsProvider(team)"
                  pTooltip="Login as provider for this account"
                  tooltipPosition="top"
                ></button>
              </div>
              <div class="d-flex tableimage pointer-cursor">
                <div *ngIf="team.status == 1">
                  <button
                    [matMenuTriggerFor]="menu"
                    aria-label="Actions"
                    pTooltip="Actions"
                    tooltipPosition="top"
                    style="all: unset; cursor: pointer"
                  >
                    <img
                      alt="Actions"
                      src="assets/images/icons/menu.svg"
                      width="24"
                      height="24"
                    />
                  </button>
                  <mat-menu #menu="matMenu">
                    <button
                      mat-menu-item
                      (click)="sendAccountToArchive(team)"
                      class="matmenuimg"
                    >
                      <img
                        alt="Actions"
                        src="assets/images/Archive.svg"
                        width="24"
                        height="24"
                        class="mr-2 image-icon"
                      />
                      <span>Send To Archive</span>
                    </button>
                  </mat-menu>
                </div>
                <div *ngIf="team.status == 2">
                  <button
                    [matMenuTriggerFor]="menu"
                    aria-label="Actions"
                    pTooltip="Actions"
                    tooltipPosition="top"
                    style="all: unset; cursor: pointer"
                  >
                    <img
                      alt="Actions"
                      src="assets/images/icons/menu.svg"
                      width="24"
                      height="24"
                    />
                  </button>
                  <mat-menu #menu="matMenu">
                    <button
                      mat-menu-item
                      (click)="revertAccountToNew(team)"
                      class="matmenuimg"
                    >
                      <img
                        alt="Actions"
                        src="assets/images/icons/leads.svg"
                        width="24"
                        height="24"
                        class="mr-2 image-icon"
                      />
                      <span>Send to New Account</span>
                    </button>
                  </mat-menu>
                </div>
              </div>
              </div>
          </td>

          <!-- <td>
            <span
              class="table-column-data fw-bold statusdata"
              *ngIf="team.status"
              [ngStyle]="{
                color: getStatusColor(team.status).textColor,
              }"
            >
              {{ team.status }}
            </span>
          </td> -->
          <!-- <td>
            <div class="text-center d-flex">
              <div class="d-flex">
                <img
                  alt="Update User"
                  src="../../../assets/images/icons/edit.svg"
                  width="24px"
                  height="24px"
                  class="me-2"
                  (click)="updateAccount(team.id)"
                  pTooltip="Update User"
                  tooltipPosition="top"
                />
              </div>
              <p-menu
                appendTo="body"
                #menu
                [model]="actionItems(team)"
                [popup]="true"
              ></p-menu>
              <img
                alt="Actions"
                src="../../../assets/images/icons/menu.svg"
                width="24px"
                height="24px"
                pTooltip="Actions"
                tooltipPosition="top"
                (click)="menu.toggle($event); $event.stopPropagation()"
              />
            </div>
          </td> -->
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr class="text-center">
          <td colspan="10" class="text-center fw-bold">
            <img
              alt="No Data"
              src="../../../assets/images/menu/no-data.gif"
              width="200"
              height="200"
            />
            <p>No Accounts Found</p>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
